<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php $collection = $this->getProductsCollection(); ?>
<?php if($collection->count()): ?>
<section class="widget-sale-products">
    <div class="grid_12 alpha omega">
        <div class="block-content iosSlider-saleproducts">
            <ul class="slider-items">
                <?php foreach ($collection as $_item): ?>
                    <li class="item">
                        <div class="product-item">
                            
                            <?php 

                                $_product = $_item;
                                $today =  time();
                                $_promo_sale='';
                                $specialprice = Mage::getModel('catalog/product')->load($_product->getId())->getSpecialPrice(); 
                                $specialPriceFromDate = Mage::getModel('catalog/product')->load($_product->getId())->getSpecialFromDate();
                                $specialPriceToDate = Mage::getModel('catalog/product')->load($_product->getId())->getSpecialToDate();

                                if ($specialprice):
                                    if($today >= strtotime( $specialPriceFromDate) && $today <= strtotime($specialPriceToDate) 
                                            || $today >= strtotime( $specialPriceFromDate) && is_null($specialPriceToDate)):
                                        $_promo_sale = '<div class="promo-sale"> </div>';
                                    endif;
                                endif;     

                                $_promo_new='';
                                $newFromDate = $_product->getData('news_from_date');
                                $newToDate = $_product->getData('news_to_date');
                                if ($newFromDate):

                                    if($today >= strtotime( $newFromDate) && $today <= strtotime($newToDate) 
                                            || $today >= strtotime( $newFromDate) && is_null($newToDate)):
                                        $_promo_new = '<div class="promo-new"> </div>';
                                    endif;
                                endif;                        
                            ?>                              
                            <?php 
                                $_gallery = Mage::getModel('catalog/product')->load($_item->getId())->getMediaGalleryImages();
                                $_image = null;
                                if (count($_gallery)) {
                                    foreach ($_gallery as $item)
                                    {
                                        $_image = $item->getFile();
                                    }     
                                }
                            ?>                                    
                            <a href="<?php echo $_item->getProductUrl() ?>" title="<?php echo $this->htmlEscape($_item->getName()) ?>" class="product-image">
                                <img src="<?php echo $this->helper('catalog/image')->init($_item, 'small_image')->resize(260,320); ?>" 
                                     alt="<?php echo $this->htmlEscape($_item->getName()) ?>" />
                                
                                <img class="hover-image" 
                                     src="<?php echo $this->helper('catalog/image')->init($_item, 'small_image',$_image)->resize(260,320); ?>" 
                                     alt="<?php echo $this->htmlEscape($_item->getName()) ?>" />
                            
                            </a>
                            <a href="#" onclick="setLocation('<?php echo $this->getAddToCartUrl($_product) ?>');" class="btn-cart btn-cart-icon">#</a>

                            <div class="promo-container">
                                <?php echo $_promo_sale; ?>
                                <?php echo $_promo_new; ?>                        
                            </div>                            
                            
                            <div class="product-details">
                                <h3 class="product-name"><a href="<?php echo $_item->getProductUrl() ?>"><?php echo $this->htmlEscape($_item->getName()) ?></a></h3>
                                <div class="product-name-divider">
                                    <div class="divider-line"></div>
                                    <div class="divider-diamond"></div>
                                </div>   
                                <?php echo $this->getPriceHtml($_item, true) ?>
                            </div>
                        </div>
                    </li>
                <?php endforeach; ?>
            </ul>
        </div>
    </div>
    
    <header class="grid_4 omega">
        <div class="sale-products-block">
        <?php echo $this->getLayout()->createBlock('cms/block')->setBlockId($this->getStaticBlock())->toHtml(); ?>

        <?php if (count($collection) >3): ?>                            
            <nav class="navigation-buttons">
                <button type="button" class="button scroll-left"><span><span><?php echo $this->__('Scroll Left') ?></span></span></button>
                <button type="button" class="button scroll-right"><span><span><?php echo $this->__('Scroll Right') ?></span></span></button>   
            </nav>    
        <?php endif; ?>   
        </div>    
    </header>    
</section>
<?php endif ?>

